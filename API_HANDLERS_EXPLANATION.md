# ๐ ูุง ูู API Handlers ูููุงุฐุง ูุญุชุงุฌูุงุ

## ๐ **ุงูุจููุฉ ุงููุนูุงุฑูุฉ ูููุธุงู:**

```
โโโโโโโโโโโโโโโโโโโ         HTTP Requests         โโโโโโโโโโโโโโโโโโโโ
โ                 โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ> โ                  โ
โ  Flutter App    โ                               โ  Backend Server  โ
โ  (Frontend)     โ  <โโโโโโโโโโโโโโโโโโโโโโโโโโ โ  (Dart/Shelf)    โ
โ                 โ      JSON Responses          โ                  โ
โโโโโโโโโโโโโโโโโโโ                               โโโโโโโโโโโโโโโโโโโโ
                                                          โ
                                                          โผ
                                                   โโโโโโโโโโโโโโโโ
                                                   โ  PostgreSQL  โ
                                                   โ   Database   โ
                                                   โโโโโโโโโโโโโโโโ
```

## ๐ฏ **ูุง ูู API Handlersุ**

**API Handlers** ูู **ูุงุฌูุงุช ุจุฑูุฌูุฉ (APIs)** ูู ุงูุฎุงุฏู (Backend Server) ุงูุชู:
1. **ุชุณุชูุจู** ุทูุจุงุช HTTP ูู ุงูุชุทุจูู
2. **ุชุชุนุงูู** ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช (PostgreSQL)
3. **ุชุฑุฌุน** ุงูุจูุงูุงุช ูู JSON

## ๐ก **ูุซุงู ุนููู:**

### **ุจุฏูู API Handlers:**
```dart
// โ ุงูุชุทุจูู ูุง ูุณุชุทูุน ุงููุตูู ููุจูุงูุงุช ูู ุงูุฎุงุฏู
// โ ูุง ูููู ูุดุงุฑูุฉ ุงูุจูุงูุงุช ุจูู ุฃุฌูุฒุฉ ูุชุนุฏุฏุฉ
// โ ุงูุจูุงูุงุช ููุฌูุฏุฉ ููุท ูุญููุงู ุนูู ุงูุฌูุงุฒ
```

### **ูุน API Handlers:**
```dart
// โ ุงูุชุทุจูู ูุฑุณู ุทูุจ HTTP
GET /api/nursing-tasks?nurseId=123

// โ API Handler ูุณุชูุจู ุงูุทูุจ
Future<Response> _getNursingTasks(Request request) async {
  // ูุฑุงุกุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  final tasks = await db.query('SELECT * FROM nursing_tasks WHERE nurse_id = ?');
  
  // ุฅุฑุฌุงุน ุงูุจูุงูุงุช ูู JSON
  return Response.ok(jsonEncode(tasks));
}

// โ ุงูุชุทุจูู ูุณุชูุจู ุงูุจูุงูุงุช ููุนุฑุถูุง
```

## ๐ **ุงููุงุฆุฏุฉ ุงูุฑุฆูุณูุฉ:**

### 1. **ูุดุงุฑูุฉ ุงูุจูุงูุงุช ุจูู ุงูุฃุฌูุฒุฉ**
```
ููุฑุถ ุนูู ุฌูุงุฒ 1  โโโ
                    โโโ> API Handler โโ> ูุงุนุฏุฉ ุจูุงูุงุช ูุดุชุฑูุฉ
ููุฑุถ ุนูู ุฌูุงุฒ 2  โโโ
```

### 2. **ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุฑูุฒู**
- ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ ูู ุฎุงุฏู ูุฑูุฒู
- ุฅุฐุง ุชุนุทู ุงูุฌูุงุฒุ ุงูุจูุงูุงุช ููุฌูุฏุฉ ูู ุงูุฎุงุฏู

### 3. **ุงููุฒุงููุฉ ุงูููุฑูุฉ**
- ุนูุฏูุง ูุถูู ููุฑุถ ูููุฉุ ุชุธูุฑ ููุฑุงู ููููุฑุถูู ุงูุขุฎุฑูู
- ุจุฏูู API handlersุ ูู ุฌูุงุฒ ูู ุจูุงูุงุช ูููุตูุฉ

### 4. **ุงูุฃูุงู ูุงูุตูุงุญูุงุช**
```dart
// API Handler ูุชุญูู ูู ุงูุตูุงุญูุงุช
if (!Rbac.has(userRole, Permission.readMedicalRecords)) {
  return Response.forbidden('ููุณ ูุฏูู ุตูุงุญูุฉ');
}
```

### 5. **ุงูุชูุงูู ูุน ุฃูุธูุฉ ุฃุฎุฑู**
- ูููู ูุฃูุธูุฉ ุฃุฎุฑู (ูุซู ูุธุงู ุงูููุงุชูุฑ) ุงููุตูู ููุจูุงูุงุช
- ูููู ุฑุจุท ุงููุธุงู ุจุฃูุธูุฉ ุฎุงุฑุฌูุฉ (ูุฎุชุจุฑุงุชุ ุจููู)

## ๐ **ูุซุงู: API Handler ูููุงู ุงูุชูุฑูุถ**

```dart
// server/lib/handlers/nursing_tasks_handler.dart
class NursingTasksHandler {
  Router get router {
    final router = Router();
    
    // GET /api/nursing-tasks?nurseId=123
    router.get('/', _getNursingTasks);
    
    // POST /api/nursing-tasks
    router.post('/', _createNursingTask);
    
    // PUT /api/nursing-tasks/456/status
    router.put('/<taskId>/status', _updateTaskStatus);
    
    return router;
  }
  
  Future<Response> _getNursingTasks(Request request) async {
    final nurseId = request.url.queryParameters['nurseId'];
    
    // ูุฑุงุกุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    final conn = await DatabaseService().connection;
    final tasks = await conn.query(
      'SELECT * FROM nursing_tasks WHERE nurse_id = @nurseId',
      substitutionValues: {'nurseId': nurseId},
    );
    
    // ุฅุฑุฌุงุน ุงูุจูุงูุงุช
    return Response.ok(jsonEncode(tasks));
  }
}
```

## ๐ **ููู ูุนูู ุงููุธุงู ุญุงููุงู:**

### **ุงููุถุน ุงููุญูู (Local Mode):**
```
Flutter App โโ> LocalDataService โโ> SQLite (ุนูู ุงูุฌูุงุฒ)
```
โ **ูุนูู ุจุฏูู API handlers** - ุงูุจูุงูุงุช ูุญููุฉ ููุท

### **ุงููุถุน ุงูุดุจูู (Network Mode):**
```
Flutter App โโ> NetworkDataService โโ> HTTP Request โโ> API Handler โโ> PostgreSQL
```
โ **ูุง ูุนูู ุจุฏูู API handlers** - ูุญุชุงุฌ handlers ููุงุชุตุงู ุจุงูุฎุงุฏู

## โ๏ธ **ูุงุฐุง ูุญุฏุซ ุจุฏูู API Handlersุ**

### **ุงููุถุน ุงูุญุงูู:**
- โ ุงููุธุงู ูุนูู ูุญููุงู (SQLite)
- โ ุงูููุฑุถ ููููู ุฅุถุงูุฉ ููุงู ูุณุฌูุงุช
- โ **ููู ุงูุจูุงูุงุช ูุง ุชูุชูู ููุฎุงุฏู**
- โ **ูุง ูููู ูุดุงุฑูุชูุง ูุน ุฃุฌูุฒุฉ ุฃุฎุฑู**
- โ **ูุง ููุฌุฏ ูุณุฎ ุงุญุชูุงุทู ูุฑูุฒู**

### **ูุน API Handlers:**
- โ ุงูุจูุงูุงุช ุชูุชูู ููุฎุงุฏู ุชููุงุฆูุงู
- โ ูููู ูุดุงุฑูุชูุง ุจูู ุฌููุน ุงูุฃุฌูุฒุฉ
- โ ูุณุฎ ุงุญุชูุงุทู ูุฑูุฒู
- โ ูุฒุงููุฉ ููุฑูุฉ

## ๐ฏ **ุงูุฎูุงุตุฉ:**

**API Handlers = ุงูุฌุณุฑ ุจูู ุงูุชุทุจูู ูุงูุฎุงุฏู**

- **ุจุฏูููุง:** ุงููุธุงู ูุนูู ูุญููุงู ููุท (ูู ุฌูุงุฒ ูููุตู)
- **ูุนูุง:** ุงููุธุงู ูุนูู ุจุดูู ูุฑูุฒู (ุฌููุน ุงูุฃุฌูุฒุฉ ูุชุตูุฉ)

## ๐ **ูู ูุญุชุงุฌูุง ุงูุขูุ**

### **ุฅุฐุง ูุงู ุงููุธุงู:**
- โ ูุณุชุฎุฏูู ุดุฎุต ูุงุญุฏ ุนูู ุฌูุงุฒ ูุงุญุฏ โ **ูุง ูุญุชุงุฌูุง ุงูุขู**
- โ ูุณุชุฎุฏูู ุนุฏุฉ ุฃุดุฎุงุต ุนูู ุฃุฌูุฒุฉ ูุฎุชููุฉ โ **ูุญุชุงุฌูุง ุถุฑูุฑู**

### **ุงูุชูุตูุฉ:**
- ุงููุธุงู ุงูุญุงูู ูุนูู ูุญููุงู ุจุดูู ุฌูุฏ
- ูููู ุฅุถุงูุฉ API handlers ูุงุญูุงู ุนูุฏ ุงูุญุงุฌุฉ ูููุฒุงููุฉ ูุงูุดุจูุฉ

---

**ุจุงุฎุชุตุงุฑ:** API Handlers ูู **ุงููุงุฌูุฉ ุงูุจุฑูุฌูุฉ** ุงูุชู ุชุฑุจุท ุงูุชุทุจูู ุจุงูุฎุงุฏูุ ูุชุณูุญ ุจูุดุงุฑูุฉ ุงูุจูุงูุงุช ูุงููุฒุงููุฉ ุจูู ุงูุฃุฌูุฒุฉ.

